"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = makeLibraries;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _shelljs = _interopRequireDefault(require("shelljs"));

var _getFileStructure = _interopRequireDefault(require("./getFileStructure"));

var _makeLib = require("./makeLib");

var _arrayForeachAsync = _interopRequireDefault(require("array-foreach-async"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const {
  resolve
} = _path.default;
const {
  cat
} = _shelljs.default;
_arrayForeachAsync.default; // eslint-disable-line

async function makeLibraries(config) {
  const {
    main
  } = (0, _getFileStructure.default)(config);
  const libs = {}; //

  const libFiles = main.filter(el => !el[1].match(/_.*$/)); // library files

  await libFiles.forEachAsync(async ([namespaceList, filename]) => {
    const namespace = namespaceList.join('/');
    const path = resolve(process.cwd(), config.WorkingDir, config.SrcDir, namespace, filename);
    const old = cat(path).stdout;
    const {
      name,
      data
    } = await (0, _makeLib.makeLib)(old, namespace, filename, config);
    libs[name] = data;
  });
  return libs;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWtlcnMvbWFrZUxpYnJhcmllcy5qcyJdLCJuYW1lcyI6WyJyZXNvbHZlIiwicGF0aCIsImNhdCIsInNoZWxsanMiLCJub25lIiwibWFrZUxpYnJhcmllcyIsImNvbmZpZyIsIm1haW4iLCJsaWJzIiwibGliRmlsZXMiLCJmaWx0ZXIiLCJlbCIsIm1hdGNoIiwiZm9yRWFjaEFzeW5jIiwibmFtZXNwYWNlTGlzdCIsImZpbGVuYW1lIiwibmFtZXNwYWNlIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJXb3JraW5nRGlyIiwiU3JjRGlyIiwib2xkIiwic3Rkb3V0IiwibmFtZSIsImRhdGEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0EsTUFBTTtBQUFFQSxFQUFBQTtBQUFGLElBQWNDLGFBQXBCO0FBQ0EsTUFBTTtBQUFFQyxFQUFBQTtBQUFGLElBQVVDLGdCQUFoQjtBQUNBQywyQixDQUFLOztBQUVVLGVBQWVDLGFBQWYsQ0FBOEJDLE1BQTlCLEVBQXNDO0FBQ25ELFFBQU07QUFBQ0MsSUFBQUE7QUFBRCxNQUFTLCtCQUFpQkQsTUFBakIsQ0FBZjtBQUNBLFFBQU1FLElBQUksR0FBRyxFQUFiLENBRm1ELENBR25EOztBQUNBLFFBQU1DLFFBQVEsR0FBR0YsSUFBSSxDQUFDRyxNQUFMLENBQVlDLEVBQUUsSUFBSSxDQUFDQSxFQUFFLENBQUMsQ0FBRCxDQUFGLENBQU1DLEtBQU4sQ0FBWSxNQUFaLENBQW5CLENBQWpCLENBSm1ELENBS25EOztBQUNBLFFBQU1ILFFBQVEsQ0FBQ0ksWUFBVCxDQUFzQixPQUFPLENBQUNDLGFBQUQsRUFBZ0JDLFFBQWhCLENBQVAsS0FBcUM7QUFDL0QsVUFBTUMsU0FBUyxHQUFHRixhQUFhLENBQUNHLElBQWQsQ0FBbUIsR0FBbkIsQ0FBbEI7QUFDQSxVQUFNaEIsSUFBSSxHQUFHRCxPQUFPLENBQUNrQixPQUFPLENBQUNDLEdBQVIsRUFBRCxFQUNsQmIsTUFBTSxDQUFDYyxVQURXLEVBQ0NkLE1BQU0sQ0FBQ2UsTUFEUixFQUNnQkwsU0FEaEIsRUFDMkJELFFBRDNCLENBQXBCO0FBRUEsVUFBTU8sR0FBRyxHQUFHcEIsR0FBRyxDQUFDRCxJQUFELENBQUgsQ0FBVXNCLE1BQXRCO0FBQ0EsVUFBTTtBQUFDQyxNQUFBQSxJQUFEO0FBQU9DLE1BQUFBO0FBQVAsUUFBZSxNQUFNLHNCQUFRSCxHQUFSLEVBQWFOLFNBQWIsRUFBd0JELFFBQXhCLEVBQWtDVCxNQUFsQyxDQUEzQjtBQUNBRSxJQUFBQSxJQUFJLENBQUNnQixJQUFELENBQUosR0FBYUMsSUFBYjtBQUNELEdBUEssQ0FBTjtBQVFBLFNBQU9qQixJQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IHNoZWxsanMgZnJvbSAnc2hlbGxqcydcbmltcG9ydCBnZXRGaWxlU3RydWN0dXJlIGZyb20gJy4vZ2V0RmlsZVN0cnVjdHVyZSdcbmltcG9ydCB7IG1ha2VMaWIgfSBmcm9tICcuL21ha2VMaWInXG5pbXBvcnQgbm9uZSBmcm9tICdhcnJheS1mb3JlYWNoLWFzeW5jJ1xuY29uc3QgeyByZXNvbHZlIH0gPSBwYXRoXG5jb25zdCB7IGNhdCB9ID0gc2hlbGxqc1xubm9uZSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIG1ha2VMaWJyYXJpZXMgKGNvbmZpZykge1xuICBjb25zdCB7bWFpbn0gPSBnZXRGaWxlU3RydWN0dXJlKGNvbmZpZylcbiAgY29uc3QgbGlicyA9IHt9XG4gIC8vXG4gIGNvbnN0IGxpYkZpbGVzID0gbWFpbi5maWx0ZXIoZWwgPT4gIWVsWzFdLm1hdGNoKC9fLiokLykpXG4gIC8vIGxpYnJhcnkgZmlsZXNcbiAgYXdhaXQgbGliRmlsZXMuZm9yRWFjaEFzeW5jKGFzeW5jIChbbmFtZXNwYWNlTGlzdCwgZmlsZW5hbWVdKSA9PiB7XG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmFtZXNwYWNlTGlzdC5qb2luKCcvJylcbiAgICBjb25zdCBwYXRoID0gcmVzb2x2ZShwcm9jZXNzLmN3ZCgpLFxuICAgICAgY29uZmlnLldvcmtpbmdEaXIsIGNvbmZpZy5TcmNEaXIsIG5hbWVzcGFjZSwgZmlsZW5hbWUpXG4gICAgY29uc3Qgb2xkID0gY2F0KHBhdGgpLnN0ZG91dFxuICAgIGNvbnN0IHtuYW1lLCBkYXRhfSA9IGF3YWl0IG1ha2VMaWIob2xkLCBuYW1lc3BhY2UsIGZpbGVuYW1lLCBjb25maWcpXG4gICAgbGlic1tuYW1lXSA9IGRhdGFcbiAgfSlcbiAgcmV0dXJuIGxpYnNcbn1cbiJdfQ==