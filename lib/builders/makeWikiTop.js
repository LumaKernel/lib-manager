"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = makeWikiTop;

require("source-map-support/register");

var _escape = require("../helpers/escape");

function makeWikiTop(topRaw, wikis, lastUpdate) {
  const wikiList0 = [];
  wikis = makeList(wikis, wikiList0);
  const wikiList = [wikiList0[0]];

  for (let i = 1; i < wikiList0.length; i++) {
    if (wikiList0[i - 1].type !== 'dir' && wikiList0[i].type !== 'dir') ;else {
      wikiList.push('line');
    }
    wikiList.push(wikiList0[i]);
  }

  const content = wikiList.map(el => {
    if (el === 'line') {
      return '';
    } else {
      const title = el.permalink ? `[${(0, _escape.mdTitleEscape)(el.title)}]({{ "${(0, _escape.quoteEscape)(el.permalink)}" | relative_url }})` : (0, _escape.mdEscape)(el.title);
      return mark(el.depth, el.type) + ' ' + title;
    }
  }).join('\n');
  return topRaw.replace(/###content###/g, content).replace(/###last_update###/g, (0, _escape.mdEscape)(lastUpdate));
} // dfs


function makeList(wikis, wikiList, depth = 0) {
  if (depth) {
    wikiList.push({
      depth,
      type: wikis.type,
      title: wikis.title,
      permalink: wikis.wiki && wikis.permalink
    });
  }

  if (wikis.child) {
    wikis.child.forEach(child => {
      makeList(child, wikiList, depth + 1);
    });
  }
}

function mark(depth, type) {
  switch (type) {
    case 'dir':
      return '#'.repeat(depth);

    case 'one':
    case 'lib':
      return '*';
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9idWlsZGVycy9tYWtlV2lraVRvcC5qcyJdLCJuYW1lcyI6WyJtYWtlV2lraVRvcCIsInRvcFJhdyIsIndpa2lzIiwibGFzdFVwZGF0ZSIsIndpa2lMaXN0MCIsIm1ha2VMaXN0Iiwid2lraUxpc3QiLCJpIiwibGVuZ3RoIiwidHlwZSIsInB1c2giLCJjb250ZW50IiwibWFwIiwiZWwiLCJ0aXRsZSIsInBlcm1hbGluayIsIm1hcmsiLCJkZXB0aCIsImpvaW4iLCJyZXBsYWNlIiwid2lraSIsImNoaWxkIiwiZm9yRWFjaCIsInJlcGVhdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBRWUsU0FBU0EsV0FBVCxDQUFzQkMsTUFBdEIsRUFBOEJDLEtBQTlCLEVBQXFDQyxVQUFyQyxFQUFpRDtBQUM5RCxRQUFNQyxTQUFTLEdBQUcsRUFBbEI7QUFDQUYsRUFBQUEsS0FBSyxHQUFHRyxRQUFRLENBQUNILEtBQUQsRUFBUUUsU0FBUixDQUFoQjtBQUNBLFFBQU1FLFFBQVEsR0FBRyxDQUFDRixTQUFTLENBQUMsQ0FBRCxDQUFWLENBQWpCOztBQUNBLE9BQUssSUFBSUcsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsU0FBUyxDQUFDSSxNQUE5QixFQUFzQ0QsQ0FBQyxFQUF2QyxFQUEyQztBQUN6QyxRQUFJSCxTQUFTLENBQUNHLENBQUMsR0FBRyxDQUFMLENBQVQsQ0FBaUJFLElBQWpCLEtBQTBCLEtBQTFCLElBQW1DTCxTQUFTLENBQUNHLENBQUQsQ0FBVCxDQUFhRSxJQUFiLEtBQXNCLEtBQTdELEVBQW1FLENBQW5FLEtBQ0s7QUFDSEgsTUFBQUEsUUFBUSxDQUFDSSxJQUFULENBQWMsTUFBZDtBQUNEO0FBQ0RKLElBQUFBLFFBQVEsQ0FBQ0ksSUFBVCxDQUFjTixTQUFTLENBQUNHLENBQUQsQ0FBdkI7QUFDRDs7QUFDRCxRQUFNSSxPQUFPLEdBQUdMLFFBQVEsQ0FBQ00sR0FBVCxDQUFhQyxFQUFFLElBQUk7QUFDakMsUUFBSUEsRUFBRSxLQUFLLE1BQVgsRUFBbUI7QUFDakIsYUFBTyxFQUFQO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsWUFBTUMsS0FBSyxHQUFHRCxFQUFFLENBQUNFLFNBQUgsR0FDVCxJQUFHLDJCQUFjRixFQUFFLENBQUNDLEtBQWpCLENBQXdCLFNBQVEseUJBQVlELEVBQUUsQ0FBQ0UsU0FBZixDQUEwQixzQkFEcEQsR0FFVixzQkFBU0YsRUFBRSxDQUFDQyxLQUFaLENBRko7QUFHQSxhQUFPRSxJQUFJLENBQUNILEVBQUUsQ0FBQ0ksS0FBSixFQUFXSixFQUFFLENBQUNKLElBQWQsQ0FBSixHQUEwQixHQUExQixHQUFnQ0ssS0FBdkM7QUFDRDtBQUNGLEdBVGUsRUFTYkksSUFUYSxDQVNSLElBVFEsQ0FBaEI7QUFVQSxTQUFPakIsTUFBTSxDQUNWa0IsT0FESSxDQUNJLGdCQURKLEVBQ3NCUixPQUR0QixFQUVKUSxPQUZJLENBRUksb0JBRkosRUFFMEIsc0JBQVNoQixVQUFULENBRjFCLENBQVA7QUFHRCxDLENBRUQ7OztBQUNBLFNBQVNFLFFBQVQsQ0FBbUJILEtBQW5CLEVBQTBCSSxRQUExQixFQUFvQ1csS0FBSyxHQUFHLENBQTVDLEVBQStDO0FBQzdDLE1BQUlBLEtBQUosRUFBVztBQUNUWCxJQUFBQSxRQUFRLENBQUNJLElBQVQsQ0FBYztBQUNaTyxNQUFBQSxLQURZO0FBRVpSLE1BQUFBLElBQUksRUFBRVAsS0FBSyxDQUFDTyxJQUZBO0FBR1pLLE1BQUFBLEtBQUssRUFBRVosS0FBSyxDQUFDWSxLQUhEO0FBSVpDLE1BQUFBLFNBQVMsRUFBRWIsS0FBSyxDQUFDa0IsSUFBTixJQUFjbEIsS0FBSyxDQUFDYTtBQUpuQixLQUFkO0FBTUQ7O0FBQ0QsTUFBSWIsS0FBSyxDQUFDbUIsS0FBVixFQUFpQjtBQUNmbkIsSUFBQUEsS0FBSyxDQUFDbUIsS0FBTixDQUFZQyxPQUFaLENBQW9CRCxLQUFLLElBQUk7QUFDM0JoQixNQUFBQSxRQUFRLENBQUNnQixLQUFELEVBQVFmLFFBQVIsRUFBa0JXLEtBQUssR0FBRyxDQUExQixDQUFSO0FBQ0QsS0FGRDtBQUdEO0FBQ0Y7O0FBRUQsU0FBU0QsSUFBVCxDQUFlQyxLQUFmLEVBQXNCUixJQUF0QixFQUE0QjtBQUMxQixVQUFRQSxJQUFSO0FBQ0UsU0FBSyxLQUFMO0FBQ0UsYUFBTyxJQUFJYyxNQUFKLENBQVdOLEtBQVgsQ0FBUDs7QUFDRixTQUFLLEtBQUw7QUFDQSxTQUFLLEtBQUw7QUFDRSxhQUFPLEdBQVA7QUFMSjtBQU9EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWRFc2NhcGUsIG1kVGl0bGVFc2NhcGUsIHF1b3RlRXNjYXBlIH0gZnJvbSAnLi4vaGVscGVycy9lc2NhcGUnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBtYWtlV2lraVRvcCAodG9wUmF3LCB3aWtpcywgbGFzdFVwZGF0ZSkge1xyXG4gIGNvbnN0IHdpa2lMaXN0MCA9IFtdXHJcbiAgd2lraXMgPSBtYWtlTGlzdCh3aWtpcywgd2lraUxpc3QwKVxyXG4gIGNvbnN0IHdpa2lMaXN0ID0gW3dpa2lMaXN0MFswXV1cclxuICBmb3IgKGxldCBpID0gMTsgaSA8IHdpa2lMaXN0MC5sZW5ndGg7IGkrKykge1xyXG4gICAgaWYgKHdpa2lMaXN0MFtpIC0gMV0udHlwZSAhPT0gJ2RpcicgJiYgd2lraUxpc3QwW2ldLnR5cGUgIT09ICdkaXInKTtcclxuICAgIGVsc2Uge1xyXG4gICAgICB3aWtpTGlzdC5wdXNoKCdsaW5lJylcclxuICAgIH1cclxuICAgIHdpa2lMaXN0LnB1c2god2lraUxpc3QwW2ldKVxyXG4gIH1cclxuICBjb25zdCBjb250ZW50ID0gd2lraUxpc3QubWFwKGVsID0+IHtcclxuICAgIGlmIChlbCA9PT0gJ2xpbmUnKSB7XHJcbiAgICAgIHJldHVybiAnJ1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgdGl0bGUgPSBlbC5wZXJtYWxpbmtcclxuICAgICAgICA/IGBbJHttZFRpdGxlRXNjYXBlKGVsLnRpdGxlKX1dKHt7IFwiJHtxdW90ZUVzY2FwZShlbC5wZXJtYWxpbmspfVwiIHwgcmVsYXRpdmVfdXJsIH19KWBcclxuICAgICAgICA6IG1kRXNjYXBlKGVsLnRpdGxlKVxyXG4gICAgICByZXR1cm4gbWFyayhlbC5kZXB0aCwgZWwudHlwZSkgKyAnICcgKyB0aXRsZVxyXG4gICAgfVxyXG4gIH0pLmpvaW4oJ1xcbicpXHJcbiAgcmV0dXJuIHRvcFJhd1xyXG4gICAgLnJlcGxhY2UoLyMjI2NvbnRlbnQjIyMvZywgY29udGVudClcclxuICAgIC5yZXBsYWNlKC8jIyNsYXN0X3VwZGF0ZSMjIy9nLCBtZEVzY2FwZShsYXN0VXBkYXRlKSlcclxufVxyXG5cclxuLy8gZGZzXHJcbmZ1bmN0aW9uIG1ha2VMaXN0ICh3aWtpcywgd2lraUxpc3QsIGRlcHRoID0gMCkge1xyXG4gIGlmIChkZXB0aCkge1xyXG4gICAgd2lraUxpc3QucHVzaCh7XHJcbiAgICAgIGRlcHRoLFxyXG4gICAgICB0eXBlOiB3aWtpcy50eXBlLFxyXG4gICAgICB0aXRsZTogd2lraXMudGl0bGUsXHJcbiAgICAgIHBlcm1hbGluazogd2lraXMud2lraSAmJiB3aWtpcy5wZXJtYWxpbmssXHJcbiAgICB9KVxyXG4gIH1cclxuICBpZiAod2lraXMuY2hpbGQpIHtcclxuICAgIHdpa2lzLmNoaWxkLmZvckVhY2goY2hpbGQgPT4ge1xyXG4gICAgICBtYWtlTGlzdChjaGlsZCwgd2lraUxpc3QsIGRlcHRoICsgMSlcclxuICAgIH0pXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBtYXJrIChkZXB0aCwgdHlwZSkge1xyXG4gIHN3aXRjaCAodHlwZSkge1xyXG4gICAgY2FzZSAnZGlyJzpcclxuICAgICAgcmV0dXJuICcjJy5yZXBlYXQoZGVwdGgpXHJcbiAgICBjYXNlICdvbmUnOlxyXG4gICAgY2FzZSAnbGliJzpcclxuICAgICAgcmV0dXJuICcqJ1xyXG4gIH1cclxufVxyXG4iXX0=