"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = makeWikiTop;

require("source-map-support/register");

var _escape = require("../helpers/escape");

function makeWikiTop(topRaw, wikis, lastUpdate) {
  const wikiList0 = [];
  wikis = makeList(wikis, wikiList0);
  const wikiList = [wikiList0[0]];

  for (let i = 1; i < wikiList0.length; i++) {
    if (wikiList0[i - 1].type !== 'dir' && wikiList0[i].type !== 'dir') ;else {
      wikiList.push('line');
    }
    wikiList.push(wikiList0[i]);
  }

  const content = wikiList.map(el => {
    if (el === 'line') {
      return '';
    } else {
      const title = el.permalink ? `[${(0, _escape.mdTitleEscape)(el.title)}]({{ "${(0, _escape.quoteEscape)(el.permalink)}" | relative_url }})` : (0, _escape.mdEscape)(el.title);
      return mark(el.depth, el.type) + ' ' + title;
    }
  }).join('\n');
  return topRaw.replace(/###content###/g, content).replace(/###last_update###/g, (0, _escape.mdEscape)(lastUpdate));
} // dfs


function makeList(wikis, wikiList, depth = 0) {
  if (depth) {
    wikiList.push({
      depth,
      type: wikis.type,
      title: wikis.title,
      permalink: wikis.wiki && wikis.permalink
    });
  }

  if (wikis.child) {
    wikis.child.forEach(child => {
      makeList(child, wikiList, depth + 1);
    });
  }
}

function mark(depth, type) {
  switch (type) {
    case 'dir':
      return '#'.repeat(depth);

    case 'one':
    case 'lib':
      return '*';
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9idWlsZGVycy9tYWtlV2lraVRvcC5qcyJdLCJuYW1lcyI6WyJtYWtlV2lraVRvcCIsInRvcFJhdyIsIndpa2lzIiwibGFzdFVwZGF0ZSIsIndpa2lMaXN0MCIsIm1ha2VMaXN0Iiwid2lraUxpc3QiLCJpIiwibGVuZ3RoIiwidHlwZSIsInB1c2giLCJjb250ZW50IiwibWFwIiwiZWwiLCJ0aXRsZSIsInBlcm1hbGluayIsIm1hcmsiLCJkZXB0aCIsImpvaW4iLCJyZXBsYWNlIiwid2lraSIsImNoaWxkIiwiZm9yRWFjaCIsInJlcGVhdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBRWUsU0FBU0EsV0FBVCxDQUFzQkMsTUFBdEIsRUFBOEJDLEtBQTlCLEVBQXFDQyxVQUFyQyxFQUFpRDtBQUM5RCxRQUFNQyxTQUFTLEdBQUcsRUFBbEI7QUFDQUYsRUFBQUEsS0FBSyxHQUFHRyxRQUFRLENBQUNILEtBQUQsRUFBUUUsU0FBUixDQUFoQjtBQUNBLFFBQU1FLFFBQVEsR0FBRyxDQUFDRixTQUFTLENBQUMsQ0FBRCxDQUFWLENBQWpCOztBQUNBLE9BQUssSUFBSUcsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsU0FBUyxDQUFDSSxNQUE5QixFQUFzQ0QsQ0FBQyxFQUF2QyxFQUEyQztBQUN6QyxRQUFJSCxTQUFTLENBQUNHLENBQUMsR0FBRyxDQUFMLENBQVQsQ0FBaUJFLElBQWpCLEtBQTBCLEtBQTFCLElBQW1DTCxTQUFTLENBQUNHLENBQUQsQ0FBVCxDQUFhRSxJQUFiLEtBQXNCLEtBQTdELEVBQW1FLENBQW5FLEtBQ0s7QUFDSEgsTUFBQUEsUUFBUSxDQUFDSSxJQUFULENBQWMsTUFBZDtBQUNEO0FBQ0RKLElBQUFBLFFBQVEsQ0FBQ0ksSUFBVCxDQUFjTixTQUFTLENBQUNHLENBQUQsQ0FBdkI7QUFDRDs7QUFDRCxRQUFNSSxPQUFPLEdBQUdMLFFBQVEsQ0FBQ00sR0FBVCxDQUFhQyxFQUFFLElBQUk7QUFDakMsUUFBSUEsRUFBRSxLQUFLLE1BQVgsRUFBbUI7QUFDakIsYUFBTyxFQUFQO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsWUFBTUMsS0FBSyxHQUFHRCxFQUFFLENBQUNFLFNBQUgsR0FDVCxJQUFHLDJCQUFjRixFQUFFLENBQUNDLEtBQWpCLENBQXdCLFNBQVEseUJBQVlELEVBQUUsQ0FBQ0UsU0FBZixDQUEwQixzQkFEcEQsR0FFVixzQkFBU0YsRUFBRSxDQUFDQyxLQUFaLENBRko7QUFHQSxhQUFPRSxJQUFJLENBQUNILEVBQUUsQ0FBQ0ksS0FBSixFQUFXSixFQUFFLENBQUNKLElBQWQsQ0FBSixHQUEwQixHQUExQixHQUFnQ0ssS0FBdkM7QUFDRDtBQUNGLEdBVGUsRUFTYkksSUFUYSxDQVNSLElBVFEsQ0FBaEI7QUFVQSxTQUFPakIsTUFBTSxDQUNWa0IsT0FESSxDQUNJLGdCQURKLEVBQ3NCUixPQUR0QixFQUVKUSxPQUZJLENBRUksb0JBRkosRUFFMEIsc0JBQVNoQixVQUFULENBRjFCLENBQVA7QUFHRCxDLENBRUQ7OztBQUNBLFNBQVNFLFFBQVQsQ0FBbUJILEtBQW5CLEVBQTBCSSxRQUExQixFQUFvQ1csS0FBSyxHQUFHLENBQTVDLEVBQStDO0FBQzdDLE1BQUlBLEtBQUosRUFBVztBQUNUWCxJQUFBQSxRQUFRLENBQUNJLElBQVQsQ0FBYztBQUNaTyxNQUFBQSxLQURZO0FBRVpSLE1BQUFBLElBQUksRUFBRVAsS0FBSyxDQUFDTyxJQUZBO0FBR1pLLE1BQUFBLEtBQUssRUFBRVosS0FBSyxDQUFDWSxLQUhEO0FBSVpDLE1BQUFBLFNBQVMsRUFBRWIsS0FBSyxDQUFDa0IsSUFBTixJQUFjbEIsS0FBSyxDQUFDYTtBQUpuQixLQUFkO0FBTUQ7O0FBQ0QsTUFBSWIsS0FBSyxDQUFDbUIsS0FBVixFQUFpQjtBQUNmbkIsSUFBQUEsS0FBSyxDQUFDbUIsS0FBTixDQUFZQyxPQUFaLENBQW9CRCxLQUFLLElBQUk7QUFDM0JoQixNQUFBQSxRQUFRLENBQUNnQixLQUFELEVBQVFmLFFBQVIsRUFBa0JXLEtBQUssR0FBRyxDQUExQixDQUFSO0FBQ0QsS0FGRDtBQUdEO0FBQ0Y7O0FBRUQsU0FBU0QsSUFBVCxDQUFlQyxLQUFmLEVBQXNCUixJQUF0QixFQUE0QjtBQUMxQixVQUFRQSxJQUFSO0FBQ0UsU0FBSyxLQUFMO0FBQ0UsYUFBTyxJQUFJYyxNQUFKLENBQVdOLEtBQVgsQ0FBUDs7QUFDRixTQUFLLEtBQUw7QUFDQSxTQUFLLEtBQUw7QUFDRSxhQUFPLEdBQVA7QUFMSjtBQU9EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWRFc2NhcGUsIG1kVGl0bGVFc2NhcGUsIHF1b3RlRXNjYXBlIH0gZnJvbSAnLi4vaGVscGVycy9lc2NhcGUnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1ha2VXaWtpVG9wICh0b3BSYXcsIHdpa2lzLCBsYXN0VXBkYXRlKSB7XG4gIGNvbnN0IHdpa2lMaXN0MCA9IFtdXG4gIHdpa2lzID0gbWFrZUxpc3Qod2lraXMsIHdpa2lMaXN0MClcbiAgY29uc3Qgd2lraUxpc3QgPSBbd2lraUxpc3QwWzBdXVxuICBmb3IgKGxldCBpID0gMTsgaSA8IHdpa2lMaXN0MC5sZW5ndGg7IGkrKykge1xuICAgIGlmICh3aWtpTGlzdDBbaSAtIDFdLnR5cGUgIT09ICdkaXInICYmIHdpa2lMaXN0MFtpXS50eXBlICE9PSAnZGlyJyk7XG4gICAgZWxzZSB7XG4gICAgICB3aWtpTGlzdC5wdXNoKCdsaW5lJylcbiAgICB9XG4gICAgd2lraUxpc3QucHVzaCh3aWtpTGlzdDBbaV0pXG4gIH1cbiAgY29uc3QgY29udGVudCA9IHdpa2lMaXN0Lm1hcChlbCA9PiB7XG4gICAgaWYgKGVsID09PSAnbGluZScpIHtcbiAgICAgIHJldHVybiAnJ1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB0aXRsZSA9IGVsLnBlcm1hbGlua1xuICAgICAgICA/IGBbJHttZFRpdGxlRXNjYXBlKGVsLnRpdGxlKX1dKHt7IFwiJHtxdW90ZUVzY2FwZShlbC5wZXJtYWxpbmspfVwiIHwgcmVsYXRpdmVfdXJsIH19KWBcbiAgICAgICAgOiBtZEVzY2FwZShlbC50aXRsZSlcbiAgICAgIHJldHVybiBtYXJrKGVsLmRlcHRoLCBlbC50eXBlKSArICcgJyArIHRpdGxlXG4gICAgfVxuICB9KS5qb2luKCdcXG4nKVxuICByZXR1cm4gdG9wUmF3XG4gICAgLnJlcGxhY2UoLyMjI2NvbnRlbnQjIyMvZywgY29udGVudClcbiAgICAucmVwbGFjZSgvIyMjbGFzdF91cGRhdGUjIyMvZywgbWRFc2NhcGUobGFzdFVwZGF0ZSkpXG59XG5cbi8vIGRmc1xuZnVuY3Rpb24gbWFrZUxpc3QgKHdpa2lzLCB3aWtpTGlzdCwgZGVwdGggPSAwKSB7XG4gIGlmIChkZXB0aCkge1xuICAgIHdpa2lMaXN0LnB1c2goe1xuICAgICAgZGVwdGgsXG4gICAgICB0eXBlOiB3aWtpcy50eXBlLFxuICAgICAgdGl0bGU6IHdpa2lzLnRpdGxlLFxuICAgICAgcGVybWFsaW5rOiB3aWtpcy53aWtpICYmIHdpa2lzLnBlcm1hbGluayxcbiAgICB9KVxuICB9XG4gIGlmICh3aWtpcy5jaGlsZCkge1xuICAgIHdpa2lzLmNoaWxkLmZvckVhY2goY2hpbGQgPT4ge1xuICAgICAgbWFrZUxpc3QoY2hpbGQsIHdpa2lMaXN0LCBkZXB0aCArIDEpXG4gICAgfSlcbiAgfVxufVxuXG5mdW5jdGlvbiBtYXJrIChkZXB0aCwgdHlwZSkge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdkaXInOlxuICAgICAgcmV0dXJuICcjJy5yZXBlYXQoZGVwdGgpXG4gICAgY2FzZSAnb25lJzpcbiAgICBjYXNlICdsaWInOlxuICAgICAgcmV0dXJuICcqJ1xuICB9XG59XG4iXX0=